(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[809],{9661:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/delivery",function(){return r(9213)}])},5932:function(e,t,r){"use strict";r.d(t,{IO:function(){return g},JU:function(){return m},PL:function(){return n},QT:function(){return u},Xo:function(){return d},ar:function(){return o},b9:function(){return a},db:function(){return c},hJ:function(){return i}});let s={products:[{id:"hemp-flower-1",name:"Purple Kush Hemp Flower",description:"Premium quality hemp flower with a rich terpene profile and a soothing aroma. Perfect for relaxation and stress relief.",category:"Flowers",subcategory:"Premium",price:29.99,salePrice:null,strain:"indica",thcContent:.2,cbdContent:18.5,inStock:!0,stockCount:50,images:["/images/products/hemp-flower-1.jpg","/images/products/hemp-flower-1-detail.jpg"],barcode:"HF10012345",coaUrl:"/coa/hemp-flower-1.pdf",tags:["premium","hemp flower","indica","relaxation"],featured:!0,createdAt:Date.now()-2592e6,updatedAt:Date.now()-432e6},{id:"cbd-oil-1",name:"Full Spectrum CBD Oil 1000mg",description:"Our premium CBD oil contains a full spectrum of cannabinoids for maximum effectiveness.",category:"CBD Oils",subcategory:"Full Spectrum",price:69.99,salePrice:59.99,strain:null,thcContent:.1,cbdContent:1e3,inStock:!0,stockCount:35,images:["/images/products/cbd-oil-1.jpg","/images/products/cbd-oil-1-detail.jpg"],barcode:"CB10056789",coaUrl:"/coa/cbd-oil-1.pdf",tags:["premium","cbd oil","full spectrum","tincture"],featured:!0,createdAt:Date.now()-1296e6,updatedAt:Date.now()-1728e5},{id:"gummies-1",name:"CBD Gummies 25mg",description:"Delicious fruit-flavored gummies with 25mg of CBD per piece.",category:"Edibles",subcategory:"Gummies",price:24.99,salePrice:null,strain:null,thcContent:0,cbdContent:25,inStock:!0,stockCount:100,images:["/images/products/gummies-1.jpg"],barcode:"ED10034567",coaUrl:"/coa/gummies-1.pdf",tags:["edibles","gummies","cbd","fruit flavor"],featured:!1,createdAt:Date.now()-3888e6,updatedAt:Date.now()-864e6}],users:[],orders:[]},i=(e,t)=>(console.log("collection() called with: collectionName=".concat(t)),{id:t,path:t,type:"collection"}),n=async e=>{console.log("getDocs called with query:",e);let t="products";e&&e.path&&(t=e.path,console.log("Using path from querySnapshot: ".concat(t)));let r=[...s[t]||[]];if(console.log("Found ".concat(r.length," products in mock data")),r.length>0&&console.log("Sample product timestamp:",r[0].createdAt,"type:",typeof r[0].createdAt),e&&e._queryConstraints&&e._queryConstraints.length>0){console.log("Applying query constraints...");let t=e._queryConstraints.filter(e=>"orderBy"===e.type);if(t.length>0){console.log("Found orderBy constraints:",t);let{field:e,direction:s}=t[0];console.log("Sorting by ".concat(e," ").concat(s)),r.sort((t,r)=>{let i=t[e],n=r[e];return(void 0===i&&(i=0),void 0===n&&(n=0),"string"!=typeof i||isNaN(Date.parse(i))||(i=Date.parse(i)),"string"!=typeof n||isNaN(Date.parse(n))||(n=Date.parse(n)),"desc"===s)?n-i:i-n}),r.length>0&&console.log("First sorted product:",r[0].name,"createdAt:",r[0].createdAt)}}console.log("Returning ".concat(r.length," products after processing query"));let i=r.map(e=>({id:e.id,data:()=>e,exists:()=>!0}));return{docs:i,forEach:e=>{i.forEach(e)},empty:0===r.length,size:r.length}},o=(e,t,r)=>({type:"where",field:e,operator:t,value:r}),a=e=>({type:"limit",value:e}),d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return{type:"orderBy",field:e,direction:t}};class l{toJSON(){return"MockFirestore"}collection(e){return console.log("MockFirestore.collection called with: ".concat(e)),{id:e,path:e,type:"collection"}}doc(e,t){return console.log("MockFirestore.doc called with: ".concat(e,", ").concat(t)),{id:t,path:"".concat(e,"/").concat(t),type:"document",async get(){let r=(s[e]||[]).find(e=>e.id===t);return{exists:()=>!!r,data:()=>r||null,id:t}}}}constructor(){this.type="firestore",console.log("MockFirestore initialized with these collections:",Object.keys(s))}}console.log("Creating mock Firestore database...");let c=new l;console.log("Mock Firestore database created and exported.");let u=async e=>{let t=await e.get();return{exists:()=>t.exists(),data:()=>t.data(),id:e.id}},m=(e,t,r)=>(console.log("doc() called with: collectionPath=".concat(t,", docId=").concat(r)),e&&"function"==typeof e.doc)?(console.log("Using db.doc() method directly"),e.doc(t,r)):(console.log("Using generic mock doc implementation"),{id:r,path:"".concat(t,"/").concat(r),type:"document",async get(){let e=(s[t]||[]).find(e=>e.id===r);return{exists:()=>!!e,data:()=>e||null,id:r}}}),g=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return console.log("Creating query with constraints:",r),{...e,_queryConstraints:r}}},9213:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var s=r(5893),i=r(7294),n=r(1163),o=r(1664),a=r.n(o),d=r(9828),l=r(5932),c=r(6197);function u(){let{userData:e,currentUser:t}=(0,c.a)(),r=(0,n.useRouter)(),[o,u]=(0,i.useState)([]),[m,g]=(0,i.useState)(!0),[p,f]=(0,i.useState)("assigned"),[x,h]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(e&&"driver"!==e.role){r.push("/");return}(async()=>{if(t)try{g(!0);let e=(0,d.IO)((0,d.hJ)(l.db,"orders"),(0,d.ar)("driverId","==",t.uid),(0,d.ar)("status","in",["ready","out_for_delivery"]),(0,d.Xo)("createdAt","desc")),r=(0,d.IO)((0,d.hJ)(l.db,"orders"),(0,d.ar)("driverId","==",t.uid),(0,d.ar)("status","in",["delivered","completed"]),(0,d.Xo)("createdAt","desc")),s=await (0,d.PL)("assigned"===p?e:r),i=[];s.forEach(e=>{i.push({id:e.id,...e.data()})}),u(i)}catch(e){console.error("Error fetching orders:",e)}finally{g(!1)}})()},[e,r,t,p]);let y=async(e,r)=>{if(t)try{h(e);let t=(0,d.JU)(l.db,"orders",e),s=Date.now(),i={status:r};"out_for_delivery"===r?i.orderPickedUpByDriver=s:"delivered"===r&&(i.orderDelivered=s),await (0,d.r7)(t,i);let n=o.map(t=>t.id===e?{...t,status:r,..."out_for_delivery"===r?{orderPickedUpByDriver:s}:{},..."delivered"===r?{orderDelivered:s}:{}}:t);u(n)}catch(e){console.error("Error updating order status:",e)}finally{h(null)}},b=e=>{y(e,"out_for_delivery")},v=e=>{y(e,"delivered")},w=async(e,r)=>{if(t)try{h(e);let t=(0,d.JU)(l.db,"orders",e);await (0,d.r7)(t,{idVerified:r});let s=o.map(t=>t.id===e?{...t,idVerified:r}:t);u(s)}catch(e){console.error("Error updating ID verification:",e)}finally{h(null)}};return(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Driver Portal"}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)("div",{className:"border-b border-gray-200",children:(0,s.jsxs)("nav",{className:"-mb-px flex",children:[(0,s.jsx)("button",{onClick:()=>f("assigned"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("assigned"===p?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Assigned Orders"}),(0,s.jsx)("button",{onClick:()=>f("completed"),className:"whitespace-nowrap ml-8 py-4 px-1 border-b-2 font-medium text-sm ".concat("completed"===p?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Completed Orders"})]})})}),m?(0,s.jsx)("div",{className:"flex justify-center py-20",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})}):o.length>0?(0,s.jsx)("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:(0,s.jsx)("ul",{className:"divide-y divide-gray-200",children:o.map(e=>{var t,r,i,n,o,d;return(0,s.jsxs)("li",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{className:"mb-4 md:mb-0",children:[(0,s.jsxs)("h2",{className:"text-lg font-medium text-gray-900",children:["Order #",e.id.slice(0,8)]}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleString()}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("ready"===e.status?"bg-yellow-100 text-yellow-800":"out_for_delivery"===e.status?"bg-blue-100 text-blue-800":"delivered"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status.replace("_"," ")}),e.idVerified&&(0,s.jsx)("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"ID Verified"})]})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,s.jsx)(a(),{href:"/delivery/orders/".concat(e.id),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"View Details"}),"ready"===e.status&&(0,s.jsx)("button",{onClick:()=>b(e.id),disabled:x===e.id,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:x===e.id?(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-4 h-4 border-t-2 border-b-2 border-white rounded-full animate-spin mr-2"}),"Processing..."]}):"Start Delivery"}),"out_for_delivery"===e.status&&(0,s.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,s.jsx)("button",{onClick:()=>v(e.id),disabled:x===e.id||!e.idVerified,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white ".concat(e.idVerified?"bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"bg-gray-400 cursor-not-allowed"),children:x===e.id?(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-4 h-4 border-t-2 border-b-2 border-white rounded-full animate-spin mr-2"}),"Processing..."]}):"Complete Delivery"}),!e.idVerified&&(0,s.jsx)("button",{onClick:()=>w(e.id,!0),disabled:x===e.id,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:x===e.id?(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-4 h-4 border-t-2 border-b-2 border-white rounded-full animate-spin mr-2"}),"Processing..."]}):"Verify ID"})]})]})})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),null===(t=e.deliveryAddress)||void 0===t?void 0:t.street,", ",null===(r=e.deliveryAddress)||void 0===r?void 0:r.city,", ",null===(i=e.deliveryAddress)||void 0===i?void 0:i.state," ",null===(n=e.deliveryAddress)||void 0===n?void 0:n.zip,(null===(o=e.deliveryAddress)||void 0===o?void 0:o.unit)&&" Unit ".concat(e.deliveryAddress.unit)]}),(null===(d=e.deliveryAddress)||void 0===d?void 0:d.notes)&&(0,s.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:[(0,s.jsx)("span",{className:"font-medium",children:"Delivery Notes:"})," ",e.deliveryAddress.notes]})]}),(0,s.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Order Summary"}),(0,s.jsx)("ul",{className:"mt-2 divide-y divide-gray-200",children:e.items.map(e=>(0,s.jsxs)("li",{className:"py-2 flex justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[e.quantity,"x"]}),(0,s.jsx)("span",{className:"ml-2 text-sm text-gray-900",children:e.name})]}),(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",(e.price*e.quantity).toFixed(2)]})]},e.productId))}),(0,s.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,s.jsx)("span",{className:"text-base font-medium text-gray-900",children:"Total"}),(0,s.jsxs)("span",{className:"text-base font-medium text-green-600",children:["$",e.total.toFixed(2)]})]})]})]},e.id)})})}):(0,s.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-8 text-center",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"})]}),(0,s.jsx)("h2",{className:"mt-4 text-lg font-medium text-gray-900",children:"assigned"===p?"No assigned deliveries":"No completed deliveries"}),(0,s.jsx)("p",{className:"mt-2 text-gray-500",children:"assigned"===p?"When you are assigned deliveries, they will appear here.":"Your completed deliveries will be shown here."})]}),(0,s.jsxs)("div",{className:"mt-8 bg-white rounded-lg shadow-md p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Scan ID for Verification"}),(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:"Use your device's camera to scan the customer's ID for age verification."}),(0,s.jsx)(a(),{href:"/delivery/scan",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:"Open Scanner"})]})]})}}},function(e){e.O(0,[16,827,888,774,179],function(){return e(e.s=9661)}),_N_E=e.O()}]);