(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[555],{3780:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/delivery/scan",function(){return r(1938)}])},5932:function(e,t,r){"use strict";r.d(t,{IO:function(){return g},JU:function(){return m},PL:function(){return s},QT:function(){return u},Xo:function(){return a},ar:function(){return i},b9:function(){return c},db:function(){return d},hJ:function(){return o}});let n={products:[{id:"hemp-flower-1",name:"Purple Kush Hemp Flower",description:"Premium quality hemp flower with a rich terpene profile and a soothing aroma. Perfect for relaxation and stress relief.",category:"Flowers",subcategory:"Premium",price:29.99,salePrice:null,strain:"indica",thcContent:.2,cbdContent:18.5,inStock:!0,stockCount:50,images:["/images/products/hemp-flower-1.jpg","/images/products/hemp-flower-1-detail.jpg"],barcode:"HF10012345",coaUrl:"/coa/hemp-flower-1.pdf",tags:["premium","hemp flower","indica","relaxation"],featured:!0,createdAt:Date.now()-2592e6,updatedAt:Date.now()-432e6},{id:"cbd-oil-1",name:"Full Spectrum CBD Oil 1000mg",description:"Our premium CBD oil contains a full spectrum of cannabinoids for maximum effectiveness.",category:"CBD Oils",subcategory:"Full Spectrum",price:69.99,salePrice:59.99,strain:null,thcContent:.1,cbdContent:1e3,inStock:!0,stockCount:35,images:["/images/products/cbd-oil-1.jpg","/images/products/cbd-oil-1-detail.jpg"],barcode:"CB10056789",coaUrl:"/coa/cbd-oil-1.pdf",tags:["premium","cbd oil","full spectrum","tincture"],featured:!0,createdAt:Date.now()-1296e6,updatedAt:Date.now()-1728e5},{id:"gummies-1",name:"CBD Gummies 25mg",description:"Delicious fruit-flavored gummies with 25mg of CBD per piece.",category:"Edibles",subcategory:"Gummies",price:24.99,salePrice:null,strain:null,thcContent:0,cbdContent:25,inStock:!0,stockCount:100,images:["/images/products/gummies-1.jpg"],barcode:"ED10034567",coaUrl:"/coa/gummies-1.pdf",tags:["edibles","gummies","cbd","fruit flavor"],featured:!1,createdAt:Date.now()-3888e6,updatedAt:Date.now()-864e6}],users:[],orders:[]},o=(e,t)=>(console.log("collection() called with: collectionName=".concat(t)),{id:t,path:t,type:"collection"}),s=async e=>{console.log("getDocs called with query:",e);let t="products";e&&e.path&&(t=e.path,console.log("Using path from querySnapshot: ".concat(t)));let r=[...n[t]||[]];if(console.log("Found ".concat(r.length," products in mock data")),r.length>0&&console.log("Sample product timestamp:",r[0].createdAt,"type:",typeof r[0].createdAt),e&&e._queryConstraints&&e._queryConstraints.length>0){console.log("Applying query constraints...");let t=e._queryConstraints.filter(e=>"orderBy"===e.type);if(t.length>0){console.log("Found orderBy constraints:",t);let{field:e,direction:n}=t[0];console.log("Sorting by ".concat(e," ").concat(n)),r.sort((t,r)=>{let o=t[e],s=r[e];return(void 0===o&&(o=0),void 0===s&&(s=0),"string"!=typeof o||isNaN(Date.parse(o))||(o=Date.parse(o)),"string"!=typeof s||isNaN(Date.parse(s))||(s=Date.parse(s)),"desc"===n)?s-o:o-s}),r.length>0&&console.log("First sorted product:",r[0].name,"createdAt:",r[0].createdAt)}}console.log("Returning ".concat(r.length," products after processing query"));let o=r.map(e=>({id:e.id,data:()=>e,exists:()=>!0}));return{docs:o,forEach:e=>{o.forEach(e)},empty:0===r.length,size:r.length}},i=(e,t,r)=>({type:"where",field:e,operator:t,value:r}),c=e=>({type:"limit",value:e}),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return{type:"orderBy",field:e,direction:t}};class l{toJSON(){return"MockFirestore"}collection(e){return console.log("MockFirestore.collection called with: ".concat(e)),{id:e,path:e,type:"collection"}}doc(e,t){return console.log("MockFirestore.doc called with: ".concat(e,", ").concat(t)),{id:t,path:"".concat(e,"/").concat(t),type:"document",async get(){let r=(n[e]||[]).find(e=>e.id===t);return{exists:()=>!!r,data:()=>r||null,id:t}}}}constructor(){this.type="firestore",console.log("MockFirestore initialized with these collections:",Object.keys(n))}}console.log("Creating mock Firestore database...");let d=new l;console.log("Mock Firestore database created and exported.");let u=async e=>{let t=await e.get();return{exists:()=>t.exists(),data:()=>t.data(),id:e.id}},m=(e,t,r)=>(console.log("doc() called with: collectionPath=".concat(t,", docId=").concat(r)),e&&"function"==typeof e.doc)?(console.log("Using db.doc() method directly"),e.doc(t,r)):(console.log("Using generic mock doc implementation"),{id:r,path:"".concat(t,"/").concat(r),type:"document",async get(){let e=(n[t]||[]).find(e=>e.id===r);return{exists:()=>!!e,data:()=>e||null,id:r}}}),g=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return console.log("Creating query with constraints:",r),{...e,_queryConstraints:r}}},1938:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var n=r(5893),o=r(7294),s=r(1163),i=r(1664),c=r.n(i),a=r(2090),l=r.n(a),d=r(6197),u=r(9828),m=r(5932);function g(){let{userData:e}=(0,d.a)(),t=(0,s.useRouter)(),[r,i]=(0,o.useState)(!1),[a,g]=(0,o.useState)(null),[h,f]=(0,o.useState)(null),[p,x]=(0,o.useState)("pending"),[y,w]=(0,o.useState)(null),[b,v]=(0,o.useState)(!1),[j,k]=(0,o.useState)(!1),[N,C]=(0,o.useState)(null),D=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(e&&"driver"!==e.role){t.push("/");return}return k(!0),()=>{r&&S()}},[e,t,r]);let S=()=>{i(!1)},_=async e=>{try{v(!0);let[t,r]=e.split(":");if(!t||!r){f("Invalid QR code format"),x("failed");return}let n=await (0,u.QT)((0,u.JU)(m.db,"orders",t));if(!n.exists()){f("Order not found"),x("failed");return}if(n.data().userId!==r){f("Order verification failed. Customer ID mismatch."),x("failed");return}await (0,u.r7)((0,u.JU)(m.db,"orders",t),{idVerified:!0}),w(t),x("success")}catch(e){console.error("Error processing scan:",e),f("Verification failed: "+e.message),x("failed")}finally{v(!1)}};return(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"ID Scanner"}),(0,n.jsx)("div",{className:"bg-white shadow-md rounded-lg p-6",children:N?(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto text-red-500 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,n.jsx)("h2",{className:"mt-4 text-lg font-medium text-gray-900",children:"Camera Error"}),(0,n.jsx)("p",{className:"mt-2 text-gray-500",children:N}),(0,n.jsx)(c(),{href:"/delivery",className:"mt-4 inline-block text-green-600 hover:text-green-800",children:"Return to Dashboard"})]}):(0,n.jsxs)(n.Fragment,{children:[b&&(0,n.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})}),!r&&!a&&(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto text-gray-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,n.jsx)("h2",{className:"mt-4 text-lg font-medium text-gray-900",children:"Ready to Scan"}),(0,n.jsx)("p",{className:"mt-2 text-gray-500",children:"Click the button below to start scanning customer ID."}),(0,n.jsx)("button",{onClick:()=>{i(!0),g(null),f(null),x("pending"),w(null)},className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:"Start Scanning"})]}),r&&(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("div",{className:"aspect-w-4 aspect-h-3 rounded-lg overflow-hidden bg-gray-100",children:[(0,n.jsx)(l(),{ref:D,delay:300,onError:e=>{console.error("QR scanner error:",e),f("Error scanning: "+e.message),S()},onScan:e=>{e&&e.text&&(g(e.text),S(),_(e.text))},style:{width:"100%"},constraints:{audio:!1,video:{facingMode:"environment"}}}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,n.jsx)("div",{className:"border-2 border-dashed border-white w-48 h-48 opacity-70"})})]}),(0,n.jsx)("div",{className:"mt-4 flex justify-center",children:(0,n.jsx)("button",{onClick:S,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:"Cancel"})})]}),h&&(0,n.jsx)("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-red-700",children:h})]})]})}),"success"===p&&(0,n.jsxs)("div",{className:"mt-6 text-center",children:[(0,n.jsx)("div",{className:"rounded-full bg-green-100 w-16 h-16 flex items-center justify-center mx-auto",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-green-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,n.jsx)("h2",{className:"mt-4 text-lg font-medium text-gray-900",children:"ID Verified Successfully"}),(0,n.jsxs)("p",{className:"mt-2 text-gray-500",children:["Order #",null==y?void 0:y.slice(0,8)," has been verified and is ready for delivery completion."]}),(0,n.jsxs)("div",{className:"mt-6 flex justify-center space-x-4",children:[(0,n.jsx)(c(),{href:"/delivery/orders/".concat(y),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700",children:"View Order"}),(0,n.jsx)(c(),{href:"/delivery",className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Return to Dashboard"})]})]})]})})]})}}},function(e){e.O(0,[16,566,827,888,774,179],function(){return e(e.s=3780)}),_N_E=e.O()}]);